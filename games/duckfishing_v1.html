<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Duck Fishing</title>
<style>
  body, html {margin:0; padding:0; font-family:Arial,sans-serif; background:#e6f7ff;}
  .wrap {max-width:900px; margin:20px auto; padding:10px;}
  h1 {text-align:center; margin-bottom:12px;}
  canvas {background:linear-gradient(180deg,#7fd3ff,#2fb0e6); display:block; margin:0 auto; border-radius:12px;}
  #instruction {margin-top:12px; font-size:14px; text-align:center; color:#333;}
  .log {margin-top:10px; min-height:60px; padding:8px; background:#ffffffcc; border-radius:10px; font-family:monospace; font-size:13px; overflow:auto;}
</style>
</head>
<body>
<div class="wrap">
  <h1>Duck Fishing</h1>
  <canvas id="poolCanvas" width="800" height="500"></canvas>
  <div id="instruction">
    Click or tap a duck to fish it out. Each duck may say <strong>Take a sip</strong> or <strong>Skip the sip</strong>. Enjoy responsibly!
  </div>
  <div class="log" id="eventLog"></div>
</div>

<script>
(() => {
  const canvas = document.getElementById('poolCanvas');
  const ctx = canvas.getContext('2d');
  const eventLog = document.getElementById('eventLog');

  const maxDucks = 8;
  let ducks = [];
  let activeDuck = null; // the duck currently showing result

  function logEvent(text){
    const el = document.createElement('div');
    el.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
    eventLog.prepend(el);
    while(eventLog.children.length>10) eventLog.removeChild(eventLog.lastChild);
  }

  // Duck constructor
  function createDuck(fall=false){
    const radius = 30;
    const willDrink = Math.random() < 0.45;
    return {
      x: Math.random()*(canvas.width-2*radius)+radius,
      y: fall ? -radius : Math.random()*(canvas.height-2*radius)+radius,
      vx: (Math.random()-0.5)*1.5,
      vy: (Math.random()-0.5)*1.5,
      radius,
      willDrink,
      caught:false,
      flipped:false,
      falling:fall
    };
  }

  function addDuck(fall=false){
    const d = createDuck(fall);
    ducks.push(d);
  }

  // draw one duck
  function drawDuck(d){
    ctx.save();
    ctx.translate(d.x,d.y);

    // draw body rotated if flipped
    if(d.flipped) ctx.rotate(Math.PI);

    // body
    ctx.beginPath();
    ctx.ellipse(0,0,d.radius*0.9,d.radius*0.6,0,0,Math.PI*2);
    ctx.fillStyle="#ffd24d";
    ctx.fill();
    // head
    ctx.beginPath();
    ctx.arc(d.radius*0.6,-d.radius*0.4,d.radius*0.4,0,Math.PI*2);
    ctx.fillStyle="#ffdc6e";
    ctx.fill();
    // beak
    ctx.beginPath();
    ctx.moveTo(d.radius*0.95,-d.radius*0.4);
    ctx.lineTo(d.radius*1.3,-d.radius*0.3);
    ctx.lineTo(d.radius*0.95,-d.radius*0.2);
    ctx.closePath();
    ctx.fillStyle="#ff9f3a";
    ctx.fill();

    // draw text upright even if flipped
    if(d.flipped){
      ctx.rotate(-Math.PI); // rotate back for text
      ctx.fillStyle="#000";
      ctx.font="14px Arial";
      ctx.textAlign="center";
      ctx.fillText(d.willDrink?"Take a sip":"Skip the sip",0,d.radius+15);
    }

    ctx.restore();
  }

  // animate
  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ducks.forEach(d=>{
      if(d.falling){
        d.y += 2;
        if(d.y>=d.radius+5) d.falling=false;
      } else if(!d.caught){
        d.x += d.vx;
        d.y += d.vy;
        if(d.x<d.radius||d.x>canvas.width-d.radius) d.vx*=-1;
        if(d.y<d.radius||d.y>canvas.height-d.radius) d.vy*=-1;
      }
    });
    ducks.forEach(drawDuck);
    requestAnimationFrame(animate);
  }

  // get duck under click
  function getDuckAt(x,y){
    for(let i=ducks.length-1;i>=0;i--){
      const d = ducks[i];
      const dx = x-d.x;
      const dy = y-d.y;
      if(Math.sqrt(dx*dx+dy*dy)<=d.radius) return d;
    }
    return null;
  }

  canvas.addEventListener('click', e=>{
    const rect = canvas.getBoundingClientRect();
    const cx = e.clientX - rect.left;
    const cy = e.clientY - rect.top;

    if(activeDuck){
      // remove previous caught duck
      ducks = ducks.filter(d=>d!==activeDuck);
      activeDuck = null;
    } else {
      const clicked = getDuckAt(cx,cy);
      if(clicked){
        clicked.caught=true;
        clicked.flipped=true;
        activeDuck=clicked;
        logEvent(`Caught a duck: ${clicked.willDrink?"Take a sip":"Skip the sip"}`);
        addDuck(true); // new duck falls in
      }
    }
  });

  // initialize pool
  for(let i=0;i<maxDucks;i++) addDuck();
  animate();

})();
</script>
</body>
</html>